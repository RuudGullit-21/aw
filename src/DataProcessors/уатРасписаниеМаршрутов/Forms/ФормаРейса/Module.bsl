#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Параметры.Свойство("Маршрут") Тогда
		Маршрут = Параметры.Маршрут;
	КонецЕсли;
	Параметры.Свойство("Выход", Выход);
	Параметры.Свойство("ПунктОтправления", ПунктОтправления);
	Параметры.Свойство("ПунктНазначения", ПунктНазначения);
	Параметры.Свойство("Грузоотправитель", Грузоотправитель);
	Параметры.Свойство("Грузополучатель", Грузополучатель);
	Параметры.Свойство("ДнейДоОтправления", ДнейДоОтправления);
	Параметры.Свойство("ДнейВПути", ДнейВПути);
	Параметры.Свойство("FTL", FTL);
КонецПроцедуры

#КонецОбласти


#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ОсновныеДействияФормыОК(Команда)
	Если ЗначениеЗаполнено(ДействуетС) И ЗначениеЗаполнено(ДействуетПо) И ДействуетС > ДействуетПо Тогда
		ТекстНСтр = НСтр("ru = 'Дата окончания действия периода должна быть больше даты начала действия периода';
			|en = 'Incorrect time period'");
		ОбщегоНазначенияКлиент.СообщитьПользователю(ТекстНСтр);
		Возврат;
	КонецЕсли;
	спрРейсСсылка=ОсновныеДействияФормыОК_Сервер();
	Закрыть(спрРейсСсылка);	
КонецПроцедуры

#КонецОбласти


#Область СлужебныеПроцедурыИФункции

&НаСервере
Функция ОсновныеДействияФормыОК_Сервер()
	спрРейс = Справочники.уатРейсыМаршрутов.СоздатьЭлемент();
	спрРейс.НомерРейса = НомерРейса;
	Если ЗначениеЗаполнено(Маршрут) Тогда
		спрРейс.Владелец = Маршрут;
	Иначе
		спрРейс.Владелец = ПунктНазначения;
		спрРейс.ПунктОтправления = ПунктОтправления;
	КонецЕсли;
	
	спрРейс.Записать();
	
	СтруктураПараметров = Новый Структура();
	СтруктураПараметров.Вставить("Маршрут", Маршрут);
	СтруктураПараметров.Вставить("Выход", Выход);
	СтруктураПараметров.Вставить("Рейс", спрРейс.Ссылка);
	СтруктураПараметров.Вставить("ДействуетС", ДействуетС);
	СтруктураПараметров.Вставить("ДействуетПо", ДействуетПо);
	СтруктураПараметров.Вставить("ПунктОтправления", ПунктОтправления);
	СтруктураПараметров.Вставить("ПунктНазначения", ПунктНазначения);
	СтруктураПараметров.Вставить("Грузоотправитель", Грузоотправитель);
	СтруктураПараметров.Вставить("Грузополучатель", Грузополучатель);
	СтруктураПараметров.Вставить("ДнейДоОтправления", ДнейДоОтправления);
	СтруктураПараметров.Вставить("ДнейВПути", ДнейВПути);
	СтруктураПараметров.Вставить("FTL", FTL);
	
	Обработки.уатРасписаниеМаршрутов.СоздатьЭлементРасписания(СтруктураПараметров);
	
	Возврат спрРейс.Ссылка;
КонецФункции

#КонецОбласти
