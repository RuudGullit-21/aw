#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

#Область ДляВызоваИзДругихПодсистем

// СтандартныеПодсистемы.ВерсионированиеОбъектов

// Определяет настройки объекта для подсистемы ВерсионированиеОбъектов.
//
// Параметры:
//  Настройки - Структура - настройки подсистемы.
Процедура ПриОпределенииНастроекВерсионированияОбъектов(Настройки) Экспорт
	
	Настройки.ПриПолученииСлужебныхРеквизитов = Ложь;
	
КонецПроцедуры

// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов

// СтандартныеПодсистемы.Печать

// Заполняет список команд печати.
// 
// Параметры:
//   КомандыПечати - ТаблицаЗначений - состав полей см. в функции УправлениеПечатью.СоздатьКоллекциюКомандПечати
//
Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
	// необходима для подключения внешних ПФ
	Заглушка = Истина;
	
КонецПроцедуры

// Конец СтандартныеПодсистемы.Печать

// СтандартныеПодсистемы.УправлениеДоступом

// Позволяет переопределить ограничение, указанное в модуле менеджера объекта метаданных.
//
// Параметры:
//  Ограничение - Структура:
//    * Текст                             - Строка - ограничение доступа для пользователей.
//                                          Если пустая строка, значит, доступ разрешен.
//    * ТекстДляВнешнихПользователей      - Строка - ограничение доступа для внешних пользователей.
//                                          Если пустая строка, значит, доступ запрещен.
//    * ПоВладельцуБезЗаписиКлючейДоступа - Неопределено - определить автоматически.
//                                        - Булево - если Ложь, то всегда записывать ключи доступа,
//                                          если Истина, тогда не записывать ключи доступа,
//                                          а использовать ключи доступа владельца (требуется,
//                                          чтобы ограничение было строго по объекту-владельцу).
//   * ПоВладельцуБезЗаписиКлючейДоступаДляВнешнихПользователей - Неопределено, Булево - также
//                                          как у параметра ПоВладельцуБезЗаписиКлючейДоступа.
//
Процедура ПриЗаполненииОграниченияДоступа(Ограничение) Экспорт
	
	Ограничение.Текст =
	"РазрешитьЧтениеИзменение
	|ГДЕ
	|	ЗначениеРазрешено(Организация)";
	
	Ограничение.ТекстДляВнешнихПользователей = Ограничение.Текст;
	
КонецПроцедуры

// Конец СтандартныеПодсистемы.УправлениеДоступом

#КонецОбласти

#КонецОбласти


#Область СлужебныйПрограммныйИнтерфейс

Процедура ИнициализироватьДанныеДокумента(ДокументСсылка, СтруктураДополнительныеСвойства) Экспорт
	

	ХарактеристикиСценария     = уатОбщегоНазначения_проф.ЗаполнитьХарактеристикиСценария(ДокументСсылка.Сценарий);
	Раздел                     = ХарактеристикиСценария.Раздел;
	ВариантАналитикиТС         = ХарактеристикиСценария.ВариантАналитикиТС;
	ВариантАналитикиКонтрагент = ХарактеристикиСценария.ВариантАналитикиКонтрагент;
	ВариантАналитикиМаршрут    = ХарактеристикиСценария.ВариантАналитикиМаршрут;
	ВариантАналитикиСтатья     = ХарактеристикиСценария.ВариантАналитикиСтатья;
	МассивПараметровВыработки  = ХарактеристикиСценария.МассивПараметровВыработки;

	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ДатаНачала",                   ДокументСсылка.ДатаНачала);
	Запрос.УстановитьПараметр("ДатаОкончания",                КонецДня(ДокументСсылка.ДатаОкончания));
	Запрос.УстановитьПараметр("Организация",                  ДокументСсылка.Организация);
	Запрос.УстановитьПараметр("ВариантАналитикиТС",           ВариантАналитикиТС);
	Запрос.УстановитьПараметр("ВариантАналитикиКонтрагент",   ВариантАналитикиКонтрагент);
	Запрос.УстановитьПараметр("ВариантАналитикиМаршрут",      ВариантАналитикиМаршрут);
	Запрос.УстановитьПараметр("флТСГруппы",                   ХарактеристикиСценария.флТСГруппы);
	Запрос.УстановитьПараметр("флКолоннаГруппы",              ХарактеристикиСценария.флКолоннаГруппы);
	Запрос.УстановитьПараметр("флКонтрагентГруппы",           ХарактеристикиСценария.флКонтрагентГруппы);
	Запрос.УстановитьПараметр("флМаршрутГруппы",              ХарактеристикиСценария.флМаршрутГруппы);
	Запрос.УстановитьПараметр("флОбъектСтроительстваГруппы",  ХарактеристикиСценария.флОбъектСтроительстваГруппы);
	Запрос.УстановитьПараметр("флНаправлениеПеревозкиГруппы", ХарактеристикиСценария.флНаправлениеПеревозкиГруппы);
	Запрос.УстановитьПараметр("МассивПараметровВыработки",    МассивПараметровВыработки);
	
	Если Раздел = Перечисления.уатРазделыПланирования.Выработка Тогда
		Запрос.УстановитьПараметр("уатРасчетСводныхПараметровВыработки", Тип("ДокументСсылка.уатРасчетСводныхПараметровВыработки"));
		Запрос.Текст =
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	уатВыработкаПоМаршрутнымЛистам_уэОбороты.Организация КАК Организация,
		|	уатВыработкаПоМаршрутнымЛистам_уэОбороты.Подразделение КАК Подразделение,
		|	ВЫБОР
		|		КОГДА &флКолоннаГруппы
		|			ТОГДА уатВыработкаПоМаршрутнымЛистам_уэОбороты.Колонна.Родитель
		|		ИНАЧЕ уатВыработкаПоМаршрутнымЛистам_уэОбороты.Колонна
		|	КОНЕЦ КАК Колонна,
		|	ВЫБОР
		|		КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ТС)
		|			ТОГДА ВЫБОР
		|					КОГДА &флТСГруппы
		|						ТОГДА уатВыработкаПоМаршрутнымЛистам_уэОбороты.ТС.Родитель
		|					ИНАЧЕ уатВыработкаПоМаршрутнымЛистам_уэОбороты.ТС
		|				КОНЕЦ
		|		ИНАЧЕ ВЫБОР
		|				КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.МодельТС)
		|					ТОГДА ВЫБОР
		|							КОГДА &флТСГруппы
		|								ТОГДА уатВыработкаПоМаршрутнымЛистам_уэОбороты.ТС.Модель.Родитель
		|							ИНАЧЕ уатВыработкаПоМаршрутнымЛистам_уэОбороты.ТС.Модель
		|						КОНЕЦ
		|				ИНАЧЕ ВЫБОР
		|						КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ТипТС)
		|							ТОГДА ВЫБОР
		|									КОГДА &флТСГруппы
		|										ТОГДА уатВыработкаПоМаршрутнымЛистам_уэОбороты.ТС.ТипТС.Родитель
		|									ИНАЧЕ уатВыработкаПоМаршрутнымЛистам_уэОбороты.ТС.ТипТС
		|								КОНЕЦ
		|						ИНАЧЕ уатВыработкаПоМаршрутнымЛистам_уэОбороты.ТС.ПринадлежностьТС
		|					КОНЕЦ
		|			КОНЕЦ
		|	КОНЕЦ КАК ДетализацияПланирования,
		|	уатВыработкаПоМаршрутнымЛистам_уэОбороты.ПараметрВыработки КАК ПараметрВыработки,
		|	уатВыработкаПоМаршрутнымЛистам_уэОбороты.ВидПеревозки КАК ВидПеревозки,
		|	ВЫБОР
		|		КОГДА &ВариантАналитикиКонтрагент = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.Заказчик)
		|			ТОГДА ВЫБОР
		|					КОГДА &флКонтрагентГруппы
		|						ТОГДА уатВыработкаПоМаршрутнымЛистам_уэОбороты.Контрагент.Родитель
		|					ИНАЧЕ уатВыработкаПоМаршрутнымЛистам_уэОбороты.Контрагент
		|				КОНЕЦ
		|		ИНАЧЕ ВЫБОР
		|				КОГДА &ВариантАналитикиКонтрагент = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.Грузоотправитель)
		|					ТОГДА ВЫБОР
		|							КОГДА &флКонтрагентГруппы
		|								ТОГДА уатВыработкаПоМаршрутнымЛистам_уэОбороты.Заказ.Грузоотправитель.Родитель
		|							ИНАЧЕ уатВыработкаПоМаршрутнымЛистам_уэОбороты.Заказ.Грузоотправитель
		|						КОНЕЦ
		|				ИНАЧЕ ВЫБОР
		|						КОГДА &флКонтрагентГруппы
		|							ТОГДА уатВыработкаПоМаршрутнымЛистам_уэОбороты.Заказ.Грузополучатель.Родитель
		|						ИНАЧЕ уатВыработкаПоМаршрутнымЛистам_уэОбороты.Заказ.Грузополучатель
		|					КОНЕЦ
		|			КОНЕЦ
		|	КОНЕЦ КАК Контрагент,
		|	ВЫБОР
		|		КОГДА &ВариантАналитикиМаршрут = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.Маршрут)
		|			ТОГДА ВЫБОР
		|					КОГДА &флМаршрутГруппы
		|						ТОГДА уатВыработкаПоМаршрутнымЛистам_уэОбороты.Маршрут.Родитель
		|					ИНАЧЕ уатВыработкаПоМаршрутнымЛистам_уэОбороты.Маршрут
		|				КОНЕЦ
		|		ИНАЧЕ ВЫБОР
		|				КОГДА &ВариантАналитикиМаршрут = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ПунктОтправления)
		|					ТОГДА ВЫБОР
		|							КОГДА &флМаршрутГруппы
		|								ТОГДА уатВыработкаПоМаршрутнымЛистам_уэОбороты.Заказ.АдресОтправления.Родитель
		|							ИНАЧЕ уатВыработкаПоМаршрутнымЛистам_уэОбороты.Заказ.АдресОтправления
		|						КОНЕЦ
		|				ИНАЧЕ ВЫБОР
		|						КОГДА &флМаршрутГруппы
		|							ТОГДА уатВыработкаПоМаршрутнымЛистам_уэОбороты.Заказ.АдресНазначения.Родитель
		|						ИНАЧЕ уатВыработкаПоМаршрутнымЛистам_уэОбороты.Заказ.АдресНазначения
		|					КОНЕЦ
		|			КОНЕЦ
		|	КОНЕЦ КАК Маршрут,
		|	ВЫБОР
		|		КОГДА &флОбъектСтроительстваГруппы
		|			ТОГДА уатВыработкаПоМаршрутнымЛистам_уэОбороты.ОбъектСтроительства.Родитель
		|		ИНАЧЕ уатВыработкаПоМаршрутнымЛистам_уэОбороты.ОбъектСтроительства
		|	КОНЕЦ КАК ОбъектСтроительства,
		|	ВЫБОР
		|		КОГДА &флНаправлениеПеревозкиГруппы
		|			ТОГДА уатВыработкаПоМаршрутнымЛистам_уэОбороты.НаправлениеПеревозки.Родитель
		|		ИНАЧЕ уатВыработкаПоМаршрутнымЛистам_уэОбороты.НаправлениеПеревозки
		|	КОНЕЦ КАК НаправлениеПеревозки,
		|	уатВыработкаПоМаршрутнымЛистам_уэОбороты.КоличествоОборот КАК Количество,
		|	уатВыработкаПоМаршрутнымЛистам_уэОбороты.Период КАК Период,
		|	уатВыработкаПоМаршрутнымЛистам_уэОбороты.Регистратор КАК ДокументРегистратор,
		|	уатВыработкаПоМаршрутнымЛистам_уэОбороты.Менеджер КАК Менеджер
		|ИЗ
		|	РегистрНакопления.уатВыработкаПоМаршрутнымЛистам_уэ.Обороты(
		|			&ДатаНачала,
		|			&ДатаОкончания,
		|			Регистратор,
		|			Организация = &Организация
		|				И ВЫБОР
		|					КОГДА ТС.ПринадлежностьТС = ЗНАЧЕНИЕ(Перечисление.уатПринадлежностьТС.Собственное)
		|						ТОГДА ПараметрВыработки.ИсточникПолученияФактЗначенийДляСобственногоТС = ЗНАЧЕНИЕ(Перечисление.уатИсточникиФактДанныхПоказателейПланирования.МаршрутныйЛист)
		|					ИНАЧЕ ПараметрВыработки.ИсточникПолученияФактЗначенийДляПривлТС = ЗНАЧЕНИЕ(Перечисление.уатИсточникиФактДанныхПоказателейПланирования.МаршрутныйЛист)
		|				КОНЕЦ) КАК уатВыработкаПоМаршрутнымЛистам_уэОбороты
		|ГДЕ
		|	(уатВыработкаПоМаршрутнымЛистам_уэОбороты.ПараметрВыработки = ЗНАЧЕНИЕ(Справочник.уатПараметрыВыработки.ПустаяСсылка)
		|			ИЛИ уатВыработкаПоМаршрутнымЛистам_уэОбороты.ПараметрВыработки В (&МассивПараметровВыработки))
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	уатВыработкаТСОбороты.Организация,
		|	уатВыработкаТСОбороты.Подразделение,
		|	ВЫБОР
		|		КОГДА &флКолоннаГруппы
		|			ТОГДА уатВыработкаТСОбороты.Колонна.Родитель
		|		ИНАЧЕ уатВыработкаТСОбороты.Колонна
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ТС)
		|			ТОГДА ВЫБОР
		|					КОГДА &флТСГруппы
		|						ТОГДА уатВыработкаТСОбороты.ТС.Родитель
		|					ИНАЧЕ уатВыработкаТСОбороты.ТС
		|				КОНЕЦ
		|		ИНАЧЕ ВЫБОР
		|				КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.МодельТС)
		|					ТОГДА ВЫБОР
		|							КОГДА &флТСГруппы
		|								ТОГДА уатВыработкаТСОбороты.ТС.Модель.Родитель
		|							ИНАЧЕ уатВыработкаТСОбороты.ТС.Модель
		|						КОНЕЦ
		|				ИНАЧЕ ВЫБОР
		|						КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ТипТС)
		|							ТОГДА ВЫБОР
		|									КОГДА &флТСГруппы
		|										ТОГДА уатВыработкаТСОбороты.ТС.ТипТС.Родитель
		|									ИНАЧЕ уатВыработкаТСОбороты.ТС.ТипТС
		|								КОНЕЦ
		|						ИНАЧЕ уатВыработкаТСОбороты.ТС.ПринадлежностьТС
		|					КОНЕЦ
		|			КОНЕЦ
		|	КОНЕЦ,
		|	уатВыработкаТСОбороты.ПараметрВыработки,
		|	уатВыработкаТСОбороты.ВидПеревозки,
		|	ВЫБОР
		|		КОГДА &флКонтрагентГруппы
		|			ТОГДА уатВыработкаТСОбороты.Контрагент.Родитель
		|		ИНАЧЕ уатВыработкаТСОбороты.Контрагент
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА &флМаршрутГруппы
		|			ТОГДА уатВыработкаТСОбороты.Маршрут.Родитель
		|		ИНАЧЕ уатВыработкаТСОбороты.Маршрут
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА &флОбъектСтроительстваГруппы
		|			ТОГДА уатВыработкаТСОбороты.ОбъектСтроительства.Родитель
		|		ИНАЧЕ уатВыработкаТСОбороты.ОбъектСтроительства
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА &флНаправлениеПеревозкиГруппы
		|			ТОГДА уатВыработкаТСОбороты.НаправлениеПеревозки.Родитель
		|		ИНАЧЕ уатВыработкаТСОбороты.НаправлениеПеревозки
		|	КОНЕЦ,
		|	СУММА(уатВыработкаТСОбороты.КоличествоОборот),
		|	уатВыработкаТСОбороты.Период,
		|	уатВыработкаТСОбороты.Регистратор,
		|	НЕОПРЕДЕЛЕНО
		|ИЗ
		|	РегистрНакопления.уатВыработкаТС.Обороты(
		|			&ДатаНачала,
		|			&ДатаОкончания,
		|			Регистратор,
		|			Организация = &Организация
		|				И ВЫБОР
		|					КОГДА ТС.ПринадлежностьТС = ЗНАЧЕНИЕ(Перечисление.уатПринадлежностьТС.Собственное)
		|						ТОГДА ПараметрВыработки.ИсточникПолученияФактЗначенийДляСобственногоТС = ЗНАЧЕНИЕ(Перечисление.уатИсточникиФактДанныхПоказателейПланирования.ПутевойЛист)
		|					ИНАЧЕ ПараметрВыработки.ИсточникПолученияФактЗначенийДляПривлТС = ЗНАЧЕНИЕ(Перечисление.уатИсточникиФактДанныхПоказателейПланирования.ПутевойЛист)
		|				КОНЕЦ) КАК уатВыработкаТСОбороты
		|ГДЕ
		|	ТИПЗНАЧЕНИЯ(уатВыработкаТСОбороты.Регистратор) <> &уатРасчетСводныхПараметровВыработки
		|	И (уатВыработкаТСОбороты.ПараметрВыработки = ЗНАЧЕНИЕ(Справочник.уатПараметрыВыработки.ПустаяСсылка)
		|			ИЛИ уатВыработкаТСОбороты.ПараметрВыработки В (&МассивПараметровВыработки))
		|
		|СГРУППИРОВАТЬ ПО
		|	уатВыработкаТСОбороты.Организация,
		|	уатВыработкаТСОбороты.Подразделение,
		|	уатВыработкаТСОбороты.ПараметрВыработки,
		|	уатВыработкаТСОбороты.ВидПеревозки,
		|	ВЫБОР
		|		КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ТС)
		|			ТОГДА ВЫБОР
		|					КОГДА &флТСГруппы
		|						ТОГДА уатВыработкаТСОбороты.ТС.Родитель
		|					ИНАЧЕ уатВыработкаТСОбороты.ТС
		|				КОНЕЦ
		|		ИНАЧЕ ВЫБОР
		|				КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.МодельТС)
		|					ТОГДА ВЫБОР
		|							КОГДА &флТСГруппы
		|								ТОГДА уатВыработкаТСОбороты.ТС.Модель.Родитель
		|							ИНАЧЕ уатВыработкаТСОбороты.ТС.Модель
		|						КОНЕЦ
		|				ИНАЧЕ ВЫБОР
		|						КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ТипТС)
		|							ТОГДА ВЫБОР
		|									КОГДА &флТСГруппы
		|										ТОГДА уатВыработкаТСОбороты.ТС.ТипТС.Родитель
		|									ИНАЧЕ уатВыработкаТСОбороты.ТС.ТипТС
		|								КОНЕЦ
		|						ИНАЧЕ уатВыработкаТСОбороты.ТС.ПринадлежностьТС
		|					КОНЕЦ
		|			КОНЕЦ
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА &флКолоннаГруппы
		|			ТОГДА уатВыработкаТСОбороты.Колонна.Родитель
		|		ИНАЧЕ уатВыработкаТСОбороты.Колонна
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА &флКонтрагентГруппы
		|			ТОГДА уатВыработкаТСОбороты.Контрагент.Родитель
		|		ИНАЧЕ уатВыработкаТСОбороты.Контрагент
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА &флМаршрутГруппы
		|			ТОГДА уатВыработкаТСОбороты.Маршрут.Родитель
		|		ИНАЧЕ уатВыработкаТСОбороты.Маршрут
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА &флОбъектСтроительстваГруппы
		|			ТОГДА уатВыработкаТСОбороты.ОбъектСтроительства.Родитель
		|		ИНАЧЕ уатВыработкаТСОбороты.ОбъектСтроительства
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА &флНаправлениеПеревозкиГруппы
		|			ТОГДА уатВыработкаТСОбороты.НаправлениеПеревозки.Родитель
		|		ИНАЧЕ уатВыработкаТСОбороты.НаправлениеПеревозки
		|	КОНЕЦ,
		|	уатВыработкаТСОбороты.Период,
		|	уатВыработкаТСОбороты.Регистратор";
		
	ИначеЕсли Раздел = Перечисления.уатРазделыПланирования.ПредоставленныеУслуги Тогда
		Запрос.УстановитьПараметр("флУслугаГруппы", ХарактеристикиСценария.флУслугаГруппы);
        Запрос.Текст =
		"ВЫБРАТЬ
		|	уатПредоставленныеУслугиОбороты.Организация КАК Организация,
		|	уатПредоставленныеУслугиОбороты.ЗаказНаТС.Подразделение КАК Подразделение,
		|	уатПредоставленныеУслугиОбороты.ПараметрВыработки КАК ПараметрВыработки,
		|	уатПредоставленныеУслугиОбороты.ВидПеревозки КАК ВидПеревозки,
		|	ВЫБОР
		|		КОГДА &флНаправлениеПеревозкиГруппы
		|			ТОГДА уатПредоставленныеУслугиОбороты.НаправлениеПеревозки.Родитель
		|		ИНАЧЕ уатПредоставленныеУслугиОбороты.НаправлениеПеревозки
		|	КОНЕЦ КАК НаправлениеПеревозки,
		|	уатПредоставленныеУслугиОбороты.ДоговорКонтрагента КАК ДоговорКонтрагента,
		|	ВЫБОР
		|		КОГДА &флКонтрагентГруппы
		|			ТОГДА уатПредоставленныеУслугиОбороты.ДоговорКонтрагента.Владелец.Родитель
		|		ИНАЧЕ уатПредоставленныеУслугиОбороты.ДоговорКонтрагента.Владелец
		|	КОНЕЦ КАК Контрагент,
		|	ВЫБОР
		|		КОГДА &флМаршрутГруппы
		|			ТОГДА уатПредоставленныеУслугиОбороты.Маршрут.Родитель
		|		ИНАЧЕ уатПредоставленныеУслугиОбороты.Маршрут
		|	КОНЕЦ КАК Маршрут,
		|	ВЫБОР
		|		КОГДА &флОбъектСтроительстваГруппы
		|			ТОГДА уатПредоставленныеУслугиОбороты.ОбъектСтроительства.Родитель
		|		ИНАЧЕ уатПредоставленныеУслугиОбороты.ОбъектСтроительства
		|	КОНЕЦ КАК ОбъектСтроительства,
		|	ВЫБОР
		|		КОГДА &флУслугаГруппы
		|			ТОГДА уатПредоставленныеУслугиОбороты.Номенклатура.Родитель
		|		ИНАЧЕ уатПредоставленныеУслугиОбороты.Номенклатура
		|	КОНЕЦ КАК Услуга,
		|	ВЫБОР
		|		КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ТС)
		|			ТОГДА ВЫБОР
		|					КОГДА &флТСГруппы
		|						ТОГДА уатПредоставленныеУслугиОбороты.ТС.Родитель
		|					ИНАЧЕ уатПредоставленныеУслугиОбороты.ТС
		|				КОНЕЦ
		|		ИНАЧЕ ВЫБОР
		|				КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.МодельТС)
		|					ТОГДА ВЫБОР
		|							КОГДА &флТСГруппы
		|								ТОГДА уатПредоставленныеУслугиОбороты.ТС.Модель.Родитель
		|							ИНАЧЕ уатПредоставленныеУслугиОбороты.ТС.Модель
		|						КОНЕЦ
		|				ИНАЧЕ ВЫБОР
		|						КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ТипТС)
		|							ТОГДА ВЫБОР
		|									КОГДА &флТСГруппы
		|										ТОГДА уатПредоставленныеУслугиОбороты.ТС.ТипТС.Родитель
		|									ИНАЧЕ уатПредоставленныеУслугиОбороты.ТС.ТипТС
		|								КОНЕЦ
		|						ИНАЧЕ уатПредоставленныеУслугиОбороты.ТС.ПринадлежностьТС
		|					КОНЕЦ
		|			КОНЕЦ
		|	КОНЕЦ КАК ДетализацияПланирования,
		|	уатПредоставленныеУслугиОбороты.Период КАК Период,
		|	уатПредоставленныеУслугиОбороты.Регистратор КАК ДокументРегистратор,
		|	уатПредоставленныеУслугиОбороты.ЗаказНаТС.Ответственный КАК Менеджер,
		|	уатПредоставленныеУслугиОбороты.КоличествоОборот КАК Количество,
		|	уатПредоставленныеУслугиОбороты.СуммаОборот КАК Сумма,
		|	уатПредоставленныеУслугиОбороты.СуммаНДСОборот КАК СуммаНДСВал,
		|	уатПредоставленныеУслугиОбороты.СуммаРеглОборот КАК СуммаРегл,
		|	уатПредоставленныеУслугиОбороты.СуммаНДСОборот КАК СуммаНДС
		|ИЗ
		|	РегистрНакопления.уатПредоставленныеУслуги.Обороты(
		|			&ДатаНачала,
		|			&ДатаОкончания,
		|			Регистратор,
		|			Организация = &Организация
		|				И ТС <> ЗНАЧЕНИЕ(Справочник.уатТС.ПустаяСсылка)) КАК уатПредоставленныеУслугиОбороты
		|ГДЕ
		|	(уатПредоставленныеУслугиОбороты.ПараметрВыработки = ЗНАЧЕНИЕ(Справочник.уатПараметрыВыработки.ПустаяСсылка)
		|			ИЛИ уатПредоставленныеУслугиОбороты.ПараметрВыработки В (&МассивПараметровВыработки))"
		
	ИначеЕсли Раздел = Перечисления.уатРазделыПланирования.ДоходыРасходы Тогда
		Запрос.УстановитьПараметр("флНоменклатураГрузаГруппы", ХарактеристикиСценария.флНоменклатураГрузаГруппы);

		Если ВариантАналитикиСтатья = Перечисления.уатВариантыАналитик.СтатьяДоходов Тогда
			Запрос.Текст =
			"ВЫБРАТЬ
			|	уатДоходы.Период КАК Период,
			|	уатДоходы.Регистратор КАК ДокументРегистратор,
			|	уатДоходы.Менеджер КАК Менеджер,
			|	уатДоходы.СтатьяДоходов КАК Статья,
			|	уатДоходы.Организация КАК Организация,
			|	уатДоходы.Подразделение КАК Подразделение,
			|	ВЫБОР
			|		КОГДА &флКолоннаГруппы
			|			ТОГДА уатДоходы.Колонна.Родитель
			|		ИНАЧЕ уатДоходы.Колонна
			|	КОНЕЦ КАК Колонна,
			|	ВЫБОР
			|		КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ТС)
			|			ТОГДА ВЫБОР
			|					КОГДА &флТСГруппы
			|						ТОГДА уатДоходы.ТС.Родитель
			|					ИНАЧЕ уатДоходы.ТС
			|				КОНЕЦ
			|		ИНАЧЕ ВЫБОР
			|				КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.МодельТС)
			|					ТОГДА ВЫБОР
			|							КОГДА &флТСГруппы
			|								ТОГДА уатДоходы.ТС.Модель.Родитель
			|							ИНАЧЕ уатДоходы.ТС.Модель
			|						КОНЕЦ
			|				ИНАЧЕ ВЫБОР
			|						КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ТипТС)
			|							ТОГДА ВЫБОР
			|									КОГДА &флТСГруппы
			|										ТОГДА уатДоходы.ТС.ТипТС.Родитель
			|									ИНАЧЕ уатДоходы.ТС.ТипТС
			|								КОНЕЦ
			|						ИНАЧЕ уатДоходы.ТС.ПринадлежностьТС
			|					КОНЕЦ
			|			КОНЕЦ
			|	КОНЕЦ КАК ДетализацияПланирования,
			|	ВЫБОР
			|		КОГДА &ВариантАналитикиКонтрагент = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.Заказчик)
			|			ТОГДА ВЫБОР
			|					КОГДА &флКонтрагентГруппы
			|						ТОГДА уатДоходы.Контрагент.Родитель
			|					ИНАЧЕ уатДоходы.Контрагент
			|				КОНЕЦ
			|		ИНАЧЕ ВЫБОР
			|				КОГДА &ВариантАналитикиКонтрагент = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.Грузоотправитель)
			|					ТОГДА ВЫБОР
			|							КОГДА &флКонтрагентГруппы
			|								ТОГДА уатДоходы.Заказ.Грузоотправитель.Родитель
			|							ИНАЧЕ уатДоходы.Заказ.Грузоотправитель
			|						КОНЕЦ
			|				ИНАЧЕ ВЫБОР
			|						КОГДА &флКонтрагентГруппы
			|							ТОГДА уатДоходы.Заказ.Грузополучатель.Родитель
			|						ИНАЧЕ уатДоходы.Заказ.Грузополучатель
			|					КОНЕЦ
			|			КОНЕЦ
			|	КОНЕЦ КАК Контрагент,
			|	ВЫБОР
			|		КОГДА &флОбъектСтроительстваГруппы
			|			ТОГДА уатДоходы.ОбъектСтроительства.Родитель
			|		ИНАЧЕ уатДоходы.ОбъектСтроительства
			|	КОНЕЦ КАК ОбъектСтроительства,
			|	ВЫБОР
			|		КОГДА &ВариантАналитикиМаршрут = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.Маршрут)
			|			ТОГДА ВЫБОР
			|					КОГДА &флМаршрутГруппы
			|						ТОГДА уатДоходы.Маршрут.Родитель
			|					ИНАЧЕ уатДоходы.Маршрут
			|				КОНЕЦ
			|		ИНАЧЕ ВЫБОР
			|				КОГДА &ВариантАналитикиМаршрут = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ПунктОтправления)
			|					ТОГДА ВЫБОР
			|							КОГДА &флМаршрутГруппы
			|								ТОГДА уатДоходы.Заказ.АдресОтправления.Родитель
			|							ИНАЧЕ уатДоходы.Заказ.АдресОтправления
			|						КОНЕЦ
			|				ИНАЧЕ ВЫБОР
			|						КОГДА &флМаршрутГруппы
			|							ТОГДА уатДоходы.Заказ.АдресНазначения.Родитель
			|						ИНАЧЕ уатДоходы.Заказ.АдресНазначения
			|					КОНЕЦ
			|			КОНЕЦ
			|	КОНЕЦ КАК Маршрут,
			|	уатДоходы.ВидПеревозки КАК ВидПеревозки,
			|	ВЫБОР
			|		КОГДА &флНаправлениеПеревозкиГруппы
			|			ТОГДА уатДоходы.НаправлениеПеревозки.Родитель
			|		ИНАЧЕ уатДоходы.НаправлениеПеревозки
			|	КОНЕЦ КАК НаправлениеПеревозки,
			|	ВЫБОР
			|		КОГДА &флНоменклатураГрузаГруппы
			|			ТОГДА уатДоходы.НоменклатураУслуги.Родитель
			|		ИНАЧЕ уатДоходы.НоменклатураУслуги
			|	КОНЕЦ КАК Номенклатура,
			|	уатПредоставленныеУслугиОбороты.ПараметрВыработки КАК ПараметрВыработки,
			|	уатДоходы.СуммаУпр КАК Сумма,
			|	уатДоходы.СуммаНДСУпр КАК СуммаНДСВал,
			|	уатДоходы.СуммаРегл КАК СуммаРегл,
			|	уатДоходы.СуммаНДС КАК СуммаНДС,
			|	уатПредоставленныеУслугиОбороты.КоличествоОборот КАК Количество
			|ИЗ
			|	РегистрНакопления.уатДоходы КАК уатДоходы
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.уатПредоставленныеУслуги.Обороты(&ДатаНачала, &ДатаОкончания, Регистратор, Организация = &Организация) КАК уатПредоставленныеУслугиОбороты
			|		ПО уатДоходы.ПараметрВыработки = уатПредоставленныеУслугиОбороты.ПараметрВыработки
			|			И уатДоходы.Регистратор = уатПредоставленныеУслугиОбороты.Регистратор
			|			И (уатДоходы.ТС <> ЗНАЧЕНИЕ(Справочник.уатТС.ПустаяСсылка))
			|ГДЕ
			|	уатДоходы.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
			|	И (уатПредоставленныеУслугиОбороты.ПараметрВыработки = ЗНАЧЕНИЕ(Справочник.уатПараметрыВыработки.ПустаяСсылка)
			|			ИЛИ уатПредоставленныеУслугиОбороты.ПараметрВыработки В (&МассивПараметровВыработки))";

		Иначе
			Запрос.Текст =
			"ВЫБРАТЬ
			|	уатРасходы.Период КАК Период,
			|	уатРасходы.Регистратор КАК ДокументРегистратор,
			|	уатРасходы.Менеджер КАК Менеджер,
			|	уатРасходы.СтатьяРасходов КАК Статья,
			|	уатРасходы.Организация КАК Организация,
			|	уатРасходы.Подразделение КАК Подразделение,
			|	ВЫБОР
			|		КОГДА &флКолоннаГруппы
			|			ТОГДА уатРасходы.Колонна.Родитель
			|		ИНАЧЕ уатРасходы.Колонна
			|	КОНЕЦ КАК Колонна,
			|	ВЫБОР
			|		КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ТС)
			|			ТОГДА ВЫБОР
			|					КОГДА &флТСГруппы
			|						ТОГДА уатРасходы.ТС.Родитель
			|					ИНАЧЕ уатРасходы.ТС
			|				КОНЕЦ
			|		ИНАЧЕ ВЫБОР
			|				КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.МодельТС)
			|					ТОГДА ВЫБОР
			|							КОГДА &флТСГруппы
			|								ТОГДА уатРасходы.ТС.Модель.Родитель
			|							ИНАЧЕ уатРасходы.ТС.Модель
			|						КОНЕЦ
			|				ИНАЧЕ ВЫБОР
			|						КОГДА &ВариантАналитикиТС = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ТипТС)
			|							ТОГДА ВЫБОР
			|									КОГДА &флТСГруппы
			|										ТОГДА уатРасходы.ТС.ТипТС.Родитель
			|									ИНАЧЕ уатРасходы.ТС.ТипТС
			|								КОНЕЦ
			|						ИНАЧЕ уатРасходы.ТС.ПринадлежностьТС
			|					КОНЕЦ
			|			КОНЕЦ
			|	КОНЕЦ КАК ДетализацияПланирования,
			|	ВЫБОР
			|		КОГДА &ВариантАналитикиКонтрагент = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.Заказчик)
			|			ТОГДА ВЫБОР
			|					КОГДА &флКонтрагентГруппы
			|						ТОГДА ВЫБОР
			|								КОГДА уатРасходы.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
			|									ТОГДА уатРасходы.Регистратор.Контрагент.Родитель
			|								ИНАЧЕ уатРасходы.Контрагент.Родитель
			|							КОНЕЦ
			|					ИНАЧЕ ВЫБОР
			|							КОГДА уатРасходы.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
			|								ТОГДА уатРасходы.Регистратор.Контрагент
			|							ИНАЧЕ уатРасходы.Контрагент
			|						КОНЕЦ
			|				КОНЕЦ
			|		ИНАЧЕ ВЫБОР
			|				КОГДА &ВариантАналитикиКонтрагент = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.Грузоотправитель)
			|					ТОГДА ВЫБОР
			|							КОГДА &флКонтрагентГруппы
			|								ТОГДА уатРасходы.Заказ.Грузоотправитель.Родитель
			|							ИНАЧЕ уатРасходы.Заказ.Грузоотправитель
			|						КОНЕЦ
			|				ИНАЧЕ ВЫБОР
			|						КОГДА &флКонтрагентГруппы
			|							ТОГДА уатРасходы.Заказ.Грузополучатель.Родитель
			|						ИНАЧЕ уатРасходы.Заказ.Грузополучатель
			|					КОНЕЦ
			|			КОНЕЦ
			|	КОНЕЦ КАК Контрагент,
			|	ВЫБОР
			|		КОГДА &флОбъектСтроительстваГруппы
			|			ТОГДА уатРасходы.ОбъектСтроительства.Родитель
			|		ИНАЧЕ уатРасходы.ОбъектСтроительства
			|	КОНЕЦ КАК ОбъектСтроительства,
			|	ВЫБОР
			|		КОГДА &ВариантАналитикиМаршрут = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.Маршрут)
			|			ТОГДА ВЫБОР
			|					КОГДА &флМаршрутГруппы
			|						ТОГДА уатРасходы.Маршрут.Родитель
			|					ИНАЧЕ уатРасходы.Маршрут
			|				КОНЕЦ
			|		ИНАЧЕ ВЫБОР
			|				КОГДА &ВариантАналитикиМаршрут = ЗНАЧЕНИЕ(Перечисление.уатВариантыАналитик.ПунктОтправления)
			|					ТОГДА ВЫБОР
			|							КОГДА &флМаршрутГруппы
			|								ТОГДА уатРасходы.Заказ.АдресОтправления.Родитель
			|							ИНАЧЕ уатРасходы.Заказ.АдресОтправления
			|						КОНЕЦ
			|				ИНАЧЕ ВЫБОР
			|						КОГДА &флМаршрутГруппы
			|							ТОГДА уатРасходы.Заказ.АдресНазначения.Родитель
			|						ИНАЧЕ уатРасходы.Заказ.АдресНазначения
			|					КОНЕЦ
			|			КОНЕЦ
			|	КОНЕЦ КАК Маршрут,
			|	уатРасходы.ВидПеревозки КАК ВидПеревозки,
			|	ВЫБОР
			|		КОГДА &флНаправлениеПеревозкиГруппы
			|			ТОГДА уатРасходы.НаправлениеПеревозки.Родитель
			|		ИНАЧЕ уатРасходы.НаправлениеПеревозки
			|	КОНЕЦ КАК НаправлениеПеревозки,
			|	ВЫБОР
			|		КОГДА &флНоменклатураГрузаГруппы
			|			ТОГДА уатРасходы.НоменклатураУслуги.Родитель
			|		ИНАЧЕ уатРасходы.НоменклатураУслуги
			|	КОНЕЦ КАК Номенклатура,
			|	уатРасходы.СтатьяРасходов.ПараметрВыработкиРаспределенияМеждуТС КАК ПараметрВыработки,
			|	уатРасходы.СуммаУпр КАК Сумма,
			|	уатРасходы.СуммаНДСУпр КАК СуммаНДСВал,
			|	уатРасходы.СуммаРегл КАК СуммаРегл,
			|	уатРасходы.СуммаНДС КАК СуммаНДС
			|ИЗ
			|	РегистрНакопления.уатРасходы КАК уатРасходы
			|ГДЕ
			|	уатРасходы.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
			|	И уатРасходы.ТС <> ЗНАЧЕНИЕ(Справочник.уатТС.ПустаяСсылка)
			|	И (уатРасходы.СтатьяРасходов.ПараметрВыработкиРаспределенияМеждуТС = ЗНАЧЕНИЕ(Справочник.уатПараметрыВыработки.ПустаяСсылка)
			|			ИЛИ уатРасходы.СтатьяРасходов.ПараметрВыработкиРаспределенияМеждуТС В (&МассивПараметровВыработки))";
		КонецЕсли;
		
	КонецЕсли;
	
	мТаб = Запрос.Выполнить().Выгрузить();
	мТаб.Колонки.Добавить("Сценарий",           Новый ОписаниеТипов("СправочникСсылка.уатСценарииПланирования"));
	мТаб.Колонки.Добавить("РазделПланирования", Новый ОписаниеТипов("ПеречислениеСсылка.уатРазделыПланирования"));
	мТаб.Колонки.Добавить("Регистратор");
	мТаб.Колонки.Добавить("ЗаписыватьВРегистр", Новый ОписаниеТипов("Булево"));
	
	мВалютаРегл = Константы.ВалютаРегламентированногоУчета.Получить();
	мВалютаУпр  = Константы.ВалютаУправленческогоУчета.Получить();
	мВалютаСцен = ДокументСсылка.Сценарий.Валюта;
	
	Для Каждого ТекСтрока ИЗ мТаб Цикл
		ТекСтрока.Сценарий           = ДокументСсылка.Сценарий;
		ТекСтрока.РазделПланирования = Раздел;
		ТекСтрока.Регистратор        = ДокументСсылка;
				
		Если Раздел = Перечисления.уатРазделыПланирования.ПредоставленныеУслуги Тогда
			ТекСтрока.Сумма = уатОбщегоНазначенияТиповые.ПересчитатьИзВалютыВВалюту(ТекСтрока.СуммаРегл,
				мВалютаРегл, мВалютаСцен, ТекСтрока.Период, ТекСтрока.Период);
			ТекСтрока.СуммаНДСВал = уатОбщегоНазначенияТиповые.ПересчитатьИзВалютыВВалюту(ТекСтрока.СуммаНДС,
				мВалютаРегл, мВалютаСцен, ТекСтрока.Период, ТекСтрока.Период);
		ИначеЕсли Раздел = Перечисления.уатРазделыПланирования.ДоходыРасходы Тогда
			Если мВалютаСцен = мВалютаРегл Тогда
				ТекСтрока.Сумма = ТекСтрока.СуммаРегл;
				ТекСтрока.СуммаНДСВал = ТекСтрока.СуммаНДС;
			Иначе
				ТекСтрока.Сумма = уатОбщегоНазначенияТиповые.ПересчитатьИзВалютыВВалюту(ТекСтрока.Сумма,
					мВалютаУпр, мВалютаСцен, ТекСтрока.Период, ТекСтрока.Период);
				ТекСтрока.СуммаНДСВал = уатОбщегоНазначенияТиповые.ПересчитатьИзВалютыВВалюту(ТекСтрока.СуммаНДС,
					мВалютаУпр, мВалютаСцен, ТекСтрока.Период, ТекСтрока.Период);
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	Если Раздел = Перечисления.уатРазделыПланирования.Выработка Тогда
		Запрос = Новый Запрос();
		Запрос.УстановитьПараметр("Сценарий",                     ДокументСсылка.Сценарий);
		Запрос.УстановитьПараметр("Организация",                  ДокументСсылка.Организация);
		Запрос.УстановитьПараметр("ДатаНачала",                   ДокументСсылка.ДатаНачала);
		Запрос.УстановитьПараметр("ДатаОкончания",                КонецДня(ДокументСсылка.ДатаОкончания));
		Запрос.УстановитьПараметр("РегистраторМЛ",                КонецДня(ДокументСсылка.ДатаОкончания));

		Запрос.Текст =
		"ВЫБРАТЬ
		|	уатСводныеПараметрыВыработкиОбороты.ПараметрВыработки КАК ПараметрВыработки,
		|	уатСводныеПараметрыВыработкиОбороты.Организация КАК Организация,
		|	уатСводныеПараметрыВыработкиОбороты.Подразделение КАК Подразделение,
		|	уатСводныеПараметрыВыработкиОбороты.Колонна КАК Колонна,
		|	уатСводныеПараметрыВыработкиОбороты.ОбъектСтроительства КАК ОбъектСтроительства,
		|	уатСводныеПараметрыВыработкиОбороты.ДетализацияПланирования КАК ДетализацияПланирования,
		|	уатСводныеПараметрыВыработкиОбороты.Контрагент КАК Контрагент,
		|	уатСводныеПараметрыВыработкиОбороты.ВидПеревозки КАК ВидПеревозки,
		|	уатСводныеПараметрыВыработкиОбороты.Маршрут КАК Маршрут,
		|	уатСводныеПараметрыВыработкиОбороты.НаправлениеПеревозки КАК НаправлениеПеревозки,
		|	уатСводныеПараметрыВыработкиОбороты.ЗначениеОборот КАК Количество,
		|	уатСводныеПараметрыВыработкиОбороты.Период КАК Период,
		|	уатСводныеПараметрыВыработкиОбороты.Регистратор КАК ДокументРегистратор,
		|	уатСводныеПараметрыВыработкиОбороты.Регистратор.Ответственный КАК Менеджер
		|ИЗ
		|	РегистрНакопления.уатСводныеПараметрыВыработки.Обороты(&ДатаНачала, &ДатаОкончания, Регистратор, Организация = &Организация) КАК уатСводныеПараметрыВыработкиОбороты
		|ГДЕ
		|	уатСводныеПараметрыВыработкиОбороты.Регистратор.Сценарий = &Сценарий";
		
		Выборка = Запрос.Выполнить().Выбрать();
		Пока Выборка.Следующий() Цикл
			Новаястрока = мТаб.Добавить();
			Новаястрока.Сценарий           = ДокументСсылка.Сценарий;
			Новаястрока.РазделПланирования = Раздел;
			Новаястрока.Регистратор        = ДокументСсылка;
			ЗаполнитьЗначенияСвойств(Новаястрока, Выборка);
		КонецЦикла;
	КонецЕсли;
	
	СтруктураДополнительныеСвойства.ТаблицыДляДвижений.Вставить("ТаблицаФактаРаботыТС", мТаб);
	
	Запрос = Новый Запрос();
	Запрос.УстановитьПараметр("ДатаНачала",     ДокументСсылка.ДатаНачала);
	Запрос.УстановитьПараметр("ДатаОкончания",  КонецДня(ДокументСсылка.ДатаОкончания));
	Запрос.УстановитьПараметр("Сценарий",       ДокументСсылка.Сценарий);
	Запрос.УстановитьПараметр("Организация",    ДокументСсылка.Организация);
	Запрос.УстановитьПараметр("Ссылка",         ДокументСсылка);
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	уатФактРаботыТСОбороты.Регистратор КАК Регистратор
	|ИЗ
	|	РегистрНакопления.уатФактРаботыТС.Обороты(
	|			&ДатаНачала,
	|			&ДатаОкончания,
	|			Регистратор,
	|			Сценарий = &Сценарий
	|				И Организация = &Организация) КАК уатФактРаботыТСОбороты
	|ГДЕ
	|	уатФактРаботыТСОбороты.Регистратор <> &Ссылка";
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		ДокОбъект = Выборка.Регистратор.ПолучитьОбъект();
		Попытка
			ДокОбъект.Записать(РежимЗаписиДокумента.ОтменаПроведения);
		Исключение
			мОтказ = Истина;
			Возврат;
		КонецПопытки;
	КонецЦикла; 
	
КонецПроцедуры // ИнициализироватьДанныеДокумента()

Процедура ВыполнитьКонтроль(ДокументСсылка, ДополнительныеСвойства, Отказ, УдалениеПроведения = Ложь) Экспорт
	
	Заглушка = Истина;
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли