
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Заголовок = НСтр("ru = 'Выберите отчет'; en = 'Choose report'");
	
	ВсеПодсистемы = ВариантыОтчетовПовтИсп.ПодсистемыТекущегоПользователя();
	ВсеРазделы = ВсеПодсистемы.Строки[0].Строки;

	МассивПодсистем = Новый Массив();
	Для Каждого СтрокаРаздел Из ВсеРазделы Цикл		
		Если СтрокаРаздел.ПолноеИмя = "Подсистема.уатМониторинг" Тогда
			МассивПодсистем.Добавить(СтрокаРаздел.Ссылка);
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
	Если МассивПодсистем.Количество() = 0 Тогда
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
	Список.Параметры.УстановитьЗначениеПараметра("ТипВнутренний",     Перечисления.ТипыОтчетов.Внутренний);
	Список.Параметры.УстановитьЗначениеПараметра("ТипРасширение",     Перечисления.ТипыОтчетов.Расширение);
	Список.Параметры.УстановитьЗначениеПараметра("ТипДополнительный", Перечисления.ТипыОтчетов.Дополнительный);
	Список.Параметры.УстановитьЗначениеПараметра("ДоступныеОтчеты",  ВариантыОтчетов.ОтчетыТекущегоПользователя());
	Список.Параметры.УстановитьЗначениеПараметра("ОтключенныеВариантыПрограммы", ВариантыОтчетовПовтИсп.ОтключенныеВариантыПрограммы());

	ПараметрыПоиска = Новый Структура;
	ПараметрыПоиска.Вставить("ЖесткийОтборПоПодсистемам", Истина);
	ПараметрыПоиска.Вставить("Подсистемы", МассивПодсистем);
	РезультатПоиска = ВариантыОтчетов.НайтиВариантыОтчетов(ПараметрыПоиска);
	Список.Параметры.УстановитьЗначениеПараметра("ВариантыПользователя", РезультатПоиска.Ссылки);
	
КонецПроцедуры

#КонецОбласти


#Область ОбработчикиСобытийЭлементовТаблицыФормыСписок

&НаКлиенте
Процедура СписокВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	ТекДанные = Элементы.Список.ТекущиеДанные;
	Если ТекДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	РезультатЗакрытия = Новый Структура();
	
	Если ТекДанные.ИмяОтчета = "уатСводныйОтчетOmnicomm" Тогда
		РезультатЗакрытия.Вставить("ОнлайнОтчет", Истина);
		РезультатЗакрытия.Вставить("Отчет", "Сводный отчет");
	ИначеЕсли ТекДанные.ИмяОтчета = "уатСтатистикаOmnicomm" Тогда
		РезультатЗакрытия.Вставить("ОнлайнОтчет", Истина);
		РезультатЗакрытия.Вставить("Отчет", "Статистика");
	ИначеЕсли ЗначениеЗаполнено(ТекДанные.Ссылка) Тогда
		РезультатЗакрытия.Вставить("ОнлайнОтчет", Ложь);
		РезультатЗакрытия.Вставить("Отчет", ТекДанные.Ссылка);
	КонецЕсли;
	
	ОповеститьОВыборе(РезультатЗакрытия);
	
КонецПроцедуры

#КонецОбласти


#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура КомандаВыбрать(Команда)
	
	ТекДанные = Элементы.Список.ТекущиеДанные;
	Если ТекДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	РезультатЗакрытия = Новый Структура();
	
	Если ТекДанные.ИмяОтчета = "уатСводныйОтчетOmnicomm" Тогда
		РезультатЗакрытия.Вставить("ОнлайнОтчет", Истина);
		РезультатЗакрытия.Вставить("Отчет", "Сводный отчет");
	ИначеЕсли ТекДанные.ИмяОтчета = "уатСтатистикаOmnicomm" Тогда
		РезультатЗакрытия.Вставить("ОнлайнОтчет", Истина);
		РезультатЗакрытия.Вставить("Отчет", "Статистика");
	ИначеЕсли ЗначениеЗаполнено(ТекДанные.Ссылка) Тогда
		РезультатЗакрытия.Вставить("ОнлайнОтчет", Ложь);
		РезультатЗакрытия.Вставить("Отчет", ТекДанные.Ссылка);
	КонецЕсли;
	
	ОповеститьОВыборе(РезультатЗакрытия);
	
КонецПроцедуры

#КонецОбласти

