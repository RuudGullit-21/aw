
#Область СлужебныйПрограммныйИнтерфейс

// Функция рассчитывает среднюю скорость поездки по указанному времени суток
//
// Параметры:
//  ТекВремя - 	 - 
// 
// Возвращаемое значение:
//   - 
//
Функция СредняяСкоростьПоездки(Знач ТекВремя = Неопределено) Экспорт
	
	Если ТекВремя = Неопределено Тогда
		ТекВремя = '00010101' + (ТекущаяДата() - НачалоДня(ТекущаяДата()));
	КонецЕсли;
	
	Запрос = Новый Запрос();
	Запрос.УстановитьПараметр("ТекВремя", '00010101' + (ТекВремя - НачалоДня(ТекВремя)));
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ ПЕРВЫЕ 1
	|	уатСредняяСкоростьДвижения.Скорость
	|ИЗ
	|	РегистрСведений.уатСредняяСкоростьДвижения КАК уатСредняяСкоростьДвижения
	|ГДЕ
	|	ВЫБОР
	|			КОГДА уатСредняяСкоростьДвижения.НачалоПериода > уатСредняяСкоростьДвижения.КонецПериода
	|				ТОГДА &ТекВремя >= уатСредняяСкоростьДвижения.НачалоПериода
	|						ИЛИ &ТекВремя <= уатСредняяСкоростьДвижения.КонецПериода
	|			ИНАЧЕ &ТекВремя МЕЖДУ уатСредняяСкоростьДвижения.НачалоПериода И уатСредняяСкоростьДвижения.КонецПериода
	|		КОНЕЦ";
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Следующий() Тогда
		Возврат Выборка.Скорость;
	Иначе
		Возврат 0;
	КонецЕсли;
	
КонецФункции

#КонецОбласти
