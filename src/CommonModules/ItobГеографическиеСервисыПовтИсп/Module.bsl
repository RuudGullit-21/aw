////////////////////////////////////////////////////////////////////////////////
// Работа с географическими сервисами (вызов сервера повторного использования)
// 
////////////////////////////////////////////////////////////////////////////////

#Область СлужебныйПрограммныйИнтерфейс
	
// Возвращает внешнюю обработку географического сервиса.
//
// Параметры:
//  ГеографическийСервис	 - СправочникСсылка.ItobГеографическиеСервисы	 - Ссылка на географический сервис.
// 
// Возвращаемое значение:
//  ВнешняяОбработка - Обработка географического сервиса.
//
Функция ВнешняяОбработка(ГеографическийСервис) Экспорт
	
	ДвоичныеДанныеОбработки 	= ГеографическийСервис.ХранилищеОбработки.Получить();
	АдресВоВременномХранилище 	= ПоместитьВоВременноеХранилище(ДвоичныеДанныеОбработки);
	ИмяОбработки 				= ПодключитьВнешнююОбработку(АдресВоВременномХранилище, ГеографическийСервис.Наименование);
	
	ТаблицаНастроекГеоСервиса = ГеографическийСервис.Параметры.Выгрузить(, "Имя, Значение");
	
	ВнешняяОбработкаОбъект = ВнешниеОбработки.Создать(ИмяОбработки, Ложь);
	ВнешняяОбработкаОбъект.Инициализация(ТаблицаНастроекГеоСервиса);
	
	
	Возврат ВнешняяОбработкаОбъект;
	
КонецФункции

Функция ОбработчикПрямогоГеокодирования() Экспорт
	
	Возврат Константы.ItobОбработчикПрямогоГеокодирования.Получить();
	
КонецФункции


Функция ОбработчикОбратногоГеокодирования() Экспорт
	
	Возврат Константы.ItobОбработчикОбратногоГеокодирования.Получить();
	
КонецФункции

Функция ОбработчикРасчетаМаршрута() Экспорт
	
	Возврат Константы.ItobОбработчикРасчетаМаршрута.Получить();
	
КонецФункции

Функция ОбработчикРасчетаРасстояния() Экспорт
	
	Возврат Константы.ItobОбработчикРасчетаРасстояния.Получить();
	
КонецФункции

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Функция ПодключитьВнешнююОбработку(Путь, Имя, БезопасныйРежим = Ложь)
	
	// Проверка на версию платформы для защиты от опасных действий.
	СистемнаяИнформация = Новый СистемнаяИнформация();
	Если ОбщегоНазначенияКлиентСервер.СравнитьВерсии(СистемнаяИнформация.ВерсияПриложения, "8.3.9.0") > 0 Тогда
		// Нужно заменить, когда параметры конфигурации "Режим совместимости" будет стоять "Версия 8.3.9" или выше.
	    Возврат ItobГеографическиеСервисыЗащитаОтОпасныхДействий.ПодключитьВнешнююОбработку(Путь, Имя, БезопасныйРежим);
	КонецЕсли; 
	
	Возврат ВнешниеОбработки.Подключить(Путь, Имя, БезопасныйРежим);
КонецФункции

#КонецОбласти 