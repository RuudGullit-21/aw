
#Область ОбработчикиСобытий

&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	ТекстОшибки = "";
	СоздатьШаблонПоУмолчанию(ТекстОшибки);
	
	Если ТекстОшибки = "" Тогда 
		ПоказатьПредупреждение(, "Шаблон создан успешно.");
		
		Если ТипЗнч(ПараметрыВыполненияКоманды.Источник) = Тип("УправляемаяФорма") 
				И ПараметрыВыполненияКоманды.Источник.ИмяФормы = "Справочник.ШаблоныСообщений.Форма.ФормаСписка"
				И Не ПараметрыВыполненияКоманды.Источник.Элементы.Найти("Список") = Неопределено Тогда 
			ПараметрыВыполненияКоманды.Источник.Элементы.Список.Обновить();
		КонецЕсли;
	Иначе 
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстОшибки);
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура СоздатьШаблонПоУмолчанию(ТекстОшибки)
	
	ШаблонПисьма = Справочники.ШаблоныСообщений.СоздатьЭлемент();
	ШаблонПисьма.Наименование                           = "Шаблон для уведомления о расхождениях в Акте приемки";
	ШаблонПисьма.Назначение                             = "Акт приемки";
	ШаблонПисьма.ПолноеИмяТипаПараметраВводаНаОсновании = "Документ.уатАктПриемки_уэ";
	ШаблонПисьма.ПредназначенДляВводаНаОсновании        = Истина;
	ШаблонПисьма.ПредназначенДляЭлектронныхПисем        = Истина;
	ШаблонПисьма.ТемаПисьма                             = "Обнаружены расхождения между планом и фактом в Акте приемки № [уатАктПриемки_уэ.Номер] от [уатАктПриемки_уэ.Дата]";
	ШаблонПисьма.ТипТекстаПисьма                        = Перечисления.СпособыРедактированияЭлектронныхПисем.HTML;
	
	ШаблонПисьма.ТекстШаблонаПисьма = 
	"Добрый день!
	|
	|В Акте приемки [уатАктПриемки_уэ.Номер] от [уатАктПриемки_уэ.Дата] зафиксированы расхождения плановых и фактических параметров груза
	|
	|Пункт: [уатАктПриемки_уэ.Пункт.Наименование]
	|[уатАктПриемки_уэ.МаршрутныйЛист]
	|Грузоотправитель: [уатАктПриемки_уэ.ДанныеЗаказаНаТС.Грузоотправитель]
	|Грузополучатель: [уатАктПриемки_уэ.ДанныеЗаказаНаТС.Грузополучатель]
	|Начало приемки: [уатАктПриемки_уэ.НачалоОперации], окончание приемки: [уатАктПриемки_уэ.ОкончаниеОперации]
	|
	|Груз: [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.ГрузовоеМесто] по Заказу на ТС [уатАктПриемки_уэ.ДанныеЗаказаНаТС.Номер] от [уатАктПриемки_уэ.ДанныеЗаказаНаТС.Дата]
	|Статус груза: [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.Статус]
	|Состояние груза: [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.Состояние]
	|
	|Количество план/факт: [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.КоличествоПлан] / [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.КоличествоФакт], [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.ЕдиницаИзмерения]
	|Вес план / факт: [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.ВесБруттоПлан] / [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.ВесБруттоФакт]
	|Количество мест план/факт: [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.КоличествоМестПлан] / [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.КоличествоМестФакт]  
	|Объем план/факт: [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.ОбъемПлан] / [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.ОбъемФакт]";
		
	ШаблонПисьма.ТекстШаблонаПисьмаHTML = 
	"<html>
	|<head>
	|<meta http-equiv=""Content-Type"" content=""text/html; charset=utf-8"" />
	|<meta http-equiv=""X-UA-Compatible"" content=""IE=Edge"" />
	|<meta name=""format-detection"" content=""telephone=no"" />
	|<style type=""text/css"">
	|body{margin:0;padding:8px;}
	|p{line-height:1.15;margin:0;white-space:pre-wrap;}
	|ol,ul{margin-top:0;margin-bottom:0;}
	|img{border:none;}
	|li>p{display:inline;}
	|</style>
	|</head>
	|<body>
	|<p>Добрый день!</p>
	|<p><br></p>
	|<p>В Акте приемки [уатАктПриемки_уэ.Номер] от [уатАктПриемки_уэ.Дата] зафиксированы расхождения плановых и фактических параметров груза</p>
	|<p><br></p>
	|<p>Пункт: [уатАктПриемки_уэ.Пункт.Наименование]</p>
	|<p>[уатАктПриемки_уэ.МаршрутныйЛист]</p>
	|<p>Грузоотправитель: [уатАктПриемки_уэ.ДанныеЗаказаНаТС.Грузоотправитель]</p>
	|<p>Грузополучатель: [уатАктПриемки_уэ.ДанныеЗаказаНаТС.Грузополучатель]</p>
	|<p>Начало приемки: [уатАктПриемки_уэ.НачалоОперации], окончание приемки: [уатАктПриемки_уэ.ОкончаниеОперации]</p>
	|<p><br></p>
	|<p>Груз: [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.ГрузовоеМесто] по Заказу на ТС [уатАктПриемки_уэ.ДанныеЗаказаНаТС.Номер] от [уатАктПриемки_уэ.ДанныеЗаказаНаТС.Дата]</p>
	|<p>Статус груза: [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.Статус]</p>
	|<p>Состояние груза: [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.Состояние]</p>
	|<p><br></p>
	|<p>Количество план/факт: [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.КоличествоПлан] / [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.КоличествоФакт], [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.ЕдиницаИзмерения]</p>
	|<p>Вес план / факт: [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.ВесБруттоПлан] / [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.ВесБруттоФакт]</p>
	|<p>Количество мест: план/факт [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.КоличествоМестПлан] / [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.КоличествоМестФакт]</p>
	|<p>Объем план/факт: [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.ОбъемПлан] / [уатАктПриемки_уэ.ДанныеСтрокиТЧГрузы.ОбъемФакт]</p>
	|</body>
	|</html>";
	
	ТекстHTML = ШаблонПисьма.ТекстШаблонаПисьмаHTML;
	
	Попытка
		ШаблонПисьма.Записать();
	Исключение
		ТекстОшибки = ИнформацияОбОшибке().Описание;
	КонецПопытки;
	
КонецПроцедуры

#КонецОбласти
