<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>НаборДанных1</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>ТС</dataPath>
			<field>ТС</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗаказНаТС</dataPath>
			<field>ЗаказНаТС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Заказ на ТС</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Order for trucking</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>МаршрутныйЛист</dataPath>
			<field>МаршрутныйЛист</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Маршрутный лист</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Routing list</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Контрагент</dataPath>
			<field>Контрагент</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СтатусЗаказа</dataPath>
			<field>СтатусЗаказа</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Статус</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Status</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ГрузовоеМесто</dataPath>
			<field>ГрузовоеМесто</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВыполнениеДокументов</dataPath>
			<field>ВыполнениеДокументов</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Выполнение документов</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Documents execution</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СостояниеЗаказа</dataPath>
			<field>СостояниеЗаказа</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Состояние заказа</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Order status</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДоходыЗаказ</dataPath>
			<field>ДоходыЗаказ</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Доходы (Заказ на ТС)</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Incomes (Order for trucking)</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
						<v8:item>
							<v8:lang>en</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДоходыМЛ</dataPath>
			<field>ДоходыМЛ</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Incomes (Routing list)</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Доходы (Маршрутный лист)</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="xs:string">ЧДЦ=2</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗатратыЗаказ</dataPath>
			<field>ЗатратыЗаказ</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Расходы (Заказ на ТС)</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Expenses (Order for trucking)</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="xs:string">ЧДЦ=2</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗатратыМЛ</dataPath>
			<field>ЗатратыМЛ</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Расходы (Маршрутный лист)</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Expenses (Routing list)</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="xs:string">ЧДЦ=2</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗатратыМЛБезНДС</dataPath>
			<field>ЗатратыМЛБезНДС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Расходы без НДС (Маршрутный лист)</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Expenses without VAT (Routing list)</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
						<v8:item>
							<v8:lang>en</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДоходыМЛБезНДС</dataPath>
			<field>ДоходыМЛБезНДС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Incomes without VAT (Routing list)</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Доходы без НДС (Маршрутный лист)</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
						<v8:item>
							<v8:lang>en</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗатратыЗаказБезНДС</dataPath>
			<field>ЗатратыЗаказБезНДС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Расходы без НДС (Заказ на ТС)</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Expenses without VAT (Order for trucking)</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
						<v8:item>
							<v8:lang>en</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДоходыЗаказБезНДС</dataPath>
			<field>ДоходыЗаказБезНДС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Incomes without VAT (Order for trucking)</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Доходы без НДС (Заказ на ТС)</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
						<v8:item>
							<v8:lang>en</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Заказ</dataPath>
			<field>Заказ</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СопроводительныйДокумент</dataPath>
			<field>СопроводительныйДокумент</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПроцентВыполнения</dataPath>
			<field>ПроцентВыполнения</field>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ РАЗРЕШЕННЫЕ
	уатМаршрутныйЛистЗаказы.Ссылка КАК МаршрутныйЛист,
	уатМаршрутныйЛистЗаказы.Ссылка.ТС КАК ТС,
	уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя КАК ЗаказНаТС,
	ЕСТЬNULL(уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя.Контрагент, ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)) КАК Контрагент,
	ВЫБОР
		КОГДА уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя.Мультимодальный
				И НЕ уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя.ЭтоЭтап
			ТОГДА ЕСТЬNULL(ТабСтатусовРодительскихЗаказов.СтатусЗаказа, ЗНАЧЕНИЕ(Справочник.уатСтатусы_уэ.Новый))
		ИНАЧЕ ВЫБОР
				КОГДА КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ЕСТЬNULL(уатСтатусыГрузов_уэСрезПоследних.Статус, ЗНАЧЕНИЕ(Справочник.уатСтатусы_уэ.Новый))) &gt; 1
					ТОГДА ЗНАЧЕНИЕ(Справочник.уатСтатусы_уэ.Составной)
				ИНАЧЕ МАКСИМУМ(ЕСТЬNULL(уатСтатусыГрузов_уэСрезПоследних.Статус, ЗНАЧЕНИЕ(Справочник.уатСтатусы_уэ.Новый)))
			КОНЕЦ
	КОНЕЦ КАК СтатусЗаказа,
	уатТекущееСостояниеВыполненияЗаказов.Состояние КАК СостояниеЗаказа,
	уатТекущееСостояниеВыполненияЗаказов.ПроцентВыполнения КАК ПроцентВыполнения
ПОМЕСТИТЬ ВТ_Документы
ИЗ
	Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.уатСтатусыГрузов_уэ.СрезПоследних КАК уатСтатусыГрузов_уэСрезПоследних
		ПО (уатСтатусыГрузов_уэСрезПоследних.Заказ = уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя.Ссылка)
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			СтатусыРодительскихЗаказов.ЗаказГрузоотправителя КАК ЗаказГрузоотправителя,
			ВЫБОР
				КОГДА КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ЕСТЬNULL(СтатусыРодительскихЗаказов.СтатусЗаказа, ЗНАЧЕНИЕ(Справочник.уатСтатусы_уэ.Новый))) &gt; 1
					ТОГДА ЗНАЧЕНИЕ(Справочник.уатСтатусы_уэ.Составной)
				ИНАЧЕ МАКСИМУМ(ЕСТЬNULL(СтатусыРодительскихЗаказов.СтатусЗаказа, ЗНАЧЕНИЕ(Справочник.уатСтатусы_уэ.Новый)))
			КОНЕЦ КАК СтатусЗаказа
		ИЗ
			(ВЫБРАТЬ
				уатЭтапыМультимодальныхПеревозок_уэ.ЗаказГрузоотправителя КАК ЗаказГрузоотправителя,
				уатЭтапыМультимодальныхПеревозок_уэ.Этап КАК Этап,
				ВЫБОР
					КОГДА КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ЕСТЬNULL(уатСтатусыГрузов_уэСрезПоследних.Статус, ЗНАЧЕНИЕ(Справочник.уатСтатусы_уэ.Новый))) &gt; 1
						ТОГДА ЗНАЧЕНИЕ(Справочник.уатСтатусы_уэ.Составной)
					ИНАЧЕ МАКСИМУМ(ЕСТЬNULL(уатСтатусыГрузов_уэСрезПоследних.Статус, ЗНАЧЕНИЕ(Справочник.уатСтатусы_уэ.Новый)))
				КОНЕЦ КАК СтатусЗаказа
			ИЗ
				РегистрСведений.уатЭтапыМультимодальныхПеревозок_уэ КАК уатЭтапыМультимодальныхПеревозок_уэ
					ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.уатСтатусыГрузов_уэ.СрезПоследних КАК уатСтатусыГрузов_уэСрезПоследних
					ПО (уатСтатусыГрузов_уэСрезПоследних.Заказ = уатЭтапыМультимодальныхПеревозок_уэ.Этап)
			
			СГРУППИРОВАТЬ ПО
				уатЭтапыМультимодальныхПеревозок_уэ.ЗаказГрузоотправителя,
				уатЭтапыМультимодальныхПеревозок_уэ.Этап) КАК СтатусыРодительскихЗаказов
		
		СГРУППИРОВАТЬ ПО
			СтатусыРодительскихЗаказов.ЗаказГрузоотправителя) КАК ТабСтатусовРодительскихЗаказов
		ПО уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя = ТабСтатусовРодительскихЗаказов.ЗаказГрузоотправителя
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.уатТекущееСостояниеВыполненияЗаказов КАК уатТекущееСостояниеВыполненияЗаказов
		ПО уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя.Ссылка = уатТекущееСостояниеВыполненияЗаказов.Заказ
ГДЕ
	ВЫБОР
			КОГДА &amp;ДатаМаршрутныхЛистов = "Дата отправления"
				ТОГДА уатМаршрутныйЛистЗаказы.Ссылка.ДатаИВремяОтправления МЕЖДУ НАЧАЛОПЕРИОДА(&amp;ДатаС, ДЕНЬ) И КОНЕЦПЕРИОДА(&amp;ДатаПо, ДЕНЬ)
			КОГДА &amp;ДатаМаршрутныхЛистов = "Дата выполнения"
				ТОГДА уатМаршрутныйЛистЗаказы.Ссылка.ДатаИВремяВыполнения МЕЖДУ НАЧАЛОПЕРИОДА(&amp;ДатаС, ДЕНЬ) И КОНЕЦПЕРИОДА(&amp;ДатаПо, ДЕНЬ)
			ИНАЧЕ уатМаршрутныйЛистЗаказы.Ссылка.Дата МЕЖДУ НАЧАЛОПЕРИОДА(&amp;ДатаС, ДЕНЬ) И КОНЕЦПЕРИОДА(&amp;ДатаПо, ДЕНЬ)
		КОНЕЦ
	И НЕ уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя = ЗНАЧЕНИЕ(Документ.уатЗаказГрузоотправителя.ПустаяСсылка)

СГРУППИРОВАТЬ ПО
	уатМаршрутныйЛистЗаказы.Ссылка,
	уатМаршрутныйЛистЗаказы.Ссылка.ТС,
	уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя,
	ЕСТЬNULL(уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя.Контрагент, ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)),
	ТабСтатусовРодительскихЗаказов.СтатусЗаказа,
	уатТекущееСостояниеВыполненияЗаказов.Состояние,
	уатТекущееСостояниеВыполненияЗаказов.ПроцентВыполнения,
	уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя.Мультимодальный,
	уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя.ЭтоЭтап

ИНДЕКСИРОВАТЬ ПО
	МаршрутныйЛист,
	ЗаказНаТС
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Документы.ЗаказНаТС КАК ЗаказНаТС
ПОМЕСТИТЬ ВТ_Заказы
ИЗ
	ВТ_Документы КАК ВТ_Документы

СГРУППИРОВАТЬ ПО
	ВТ_Документы.ЗаказНаТС
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Документы.МаршрутныйЛист КАК МаршрутныйЛист
ПОМЕСТИТЬ ВТ_МЛ
ИЗ
	ВТ_Документы КАК ВТ_Документы

СГРУППИРОВАТЬ ПО
	ВТ_Документы.МаршрутныйЛист
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Заказы.ЗаказНаТС КАК ЗаказНаТС,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ВТ_Заказы.ЗаказНаТС.УчитыватьНДС, ЛОЖЬ)
					И НЕ ЕСТЬNULL(ВТ_Заказы.ЗаказНаТС.СуммаВключаетНДС, ЛОЖЬ)
				ТОГДА ЕСТЬNULL(уатЗаказГрузоотправителяДоходы.Сумма, 0) + ЕСТЬNULL(уатЗаказГрузоотправителяДоходы.СуммаНДС, 0)
			ИНАЧЕ ЕСТЬNULL(уатЗаказГрузоотправителяДоходы.Сумма, 0)
		КОНЕЦ) КАК ДоходыЗаказ,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ВТ_Заказы.ЗаказНаТС.УчитыватьНДС, ЛОЖЬ)
					И НЕ ЕСТЬNULL(ВТ_Заказы.ЗаказНаТС.СуммаВключаетНДС, ЛОЖЬ)
				ТОГДА ЕСТЬNULL(уатЗаказГрузоотправителяЗатраты.Сумма, 0) + ЕСТЬNULL(уатЗаказГрузоотправителяЗатраты.СуммаНДС, 0)
			ИНАЧЕ ЕСТЬNULL(уатЗаказГрузоотправителяЗатраты.Сумма, 0)
		КОНЕЦ) КАК ЗатратыЗаказ,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ВТ_Заказы.ЗаказНаТС.УчитыватьНДС, ЛОЖЬ)
					И ЕСТЬNULL(ВТ_Заказы.ЗаказНаТС.СуммаВключаетНДС, ЛОЖЬ)
				ТОГДА ЕСТЬNULL(уатЗаказГрузоотправителяДоходы.Сумма, 0) - ЕСТЬNULL(уатЗаказГрузоотправителяДоходы.СуммаНДС, 0)
			ИНАЧЕ ЕСТЬNULL(уатЗаказГрузоотправителяДоходы.Сумма, 0)
		КОНЕЦ) КАК ДоходыЗаказБезНДС,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ВТ_Заказы.ЗаказНаТС.УчитыватьНДС, ЛОЖЬ)
					И ЕСТЬNULL(ВТ_Заказы.ЗаказНаТС.СуммаВключаетНДС, ЛОЖЬ)
				ТОГДА ЕСТЬNULL(уатЗаказГрузоотправителяЗатраты.Сумма, 0) - ЕСТЬNULL(уатЗаказГрузоотправителяЗатраты.СуммаНДС, 0)
			ИНАЧЕ ЕСТЬNULL(уатЗаказГрузоотправителяЗатраты.Сумма, 0)
		КОНЕЦ) КАК ЗатратыЗаказБезНДС
ПОМЕСТИТЬ ВТ_СуммыПоЗаказам
ИЗ
	ВТ_Заказы КАК ВТ_Заказы
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатЗаказГрузоотправителя.Услуги КАК уатЗаказГрузоотправителяДоходы
		ПО ВТ_Заказы.ЗаказНаТС = уатЗаказГрузоотправителяДоходы.Ссылка
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатЗаказГрузоотправителя.Расходы КАК уатЗаказГрузоотправителяЗатраты
		ПО ВТ_Заказы.ЗаказНаТС = уатЗаказГрузоотправителяЗатраты.Ссылка

СГРУППИРОВАТЬ ПО
	ВТ_Заказы.ЗаказНаТС
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_МЛ.МаршрутныйЛист КАК МаршрутныйЛист,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(уатМаршрутныйЛистДоходы.УчитыватьНДС, ЛОЖЬ)
					И НЕ ЕСТЬNULL(уатМаршрутныйЛистДоходы.СуммаВключаетНДС, ЛОЖЬ)
				ТОГДА ЕСТЬNULL(уатМаршрутныйЛистДоходы.Сумма, 0) + ЕСТЬNULL(уатМаршрутныйЛистДоходы.СуммаНДС, 0)
			ИНАЧЕ ЕСТЬNULL(уатМаршрутныйЛистДоходы.Сумма, 0)
		КОНЕЦ) КАК ДоходыМЛ,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(уатМаршрутныйЛистЗатраты.УчитыватьНДС, ЛОЖЬ)
					И НЕ ЕСТЬNULL(уатМаршрутныйЛистЗатраты.СуммаВключаетНДС, ЛОЖЬ)
				ТОГДА ЕСТЬNULL(уатМаршрутныйЛистЗатраты.Сумма, 0) + ЕСТЬNULL(уатМаршрутныйЛистЗатраты.СуммаНДС, 0)
			ИНАЧЕ ЕСТЬNULL(уатМаршрутныйЛистЗатраты.Сумма, 0)
		КОНЕЦ) КАК ЗатратыМЛ,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(уатМаршрутныйЛистДоходы.УчитыватьНДС, ЛОЖЬ)
					И ЕСТЬNULL(уатМаршрутныйЛистДоходы.СуммаВключаетНДС, ЛОЖЬ)
				ТОГДА ЕСТЬNULL(уатМаршрутныйЛистДоходы.Сумма, 0) - ЕСТЬNULL(уатМаршрутныйЛистДоходы.СуммаНДС, 0)
			ИНАЧЕ ЕСТЬNULL(уатМаршрутныйЛистДоходы.Сумма, 0)
		КОНЕЦ) КАК ДоходыМЛБезНДС,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(уатМаршрутныйЛистЗатраты.УчитыватьНДС, ЛОЖЬ)
					И ЕСТЬNULL(уатМаршрутныйЛистЗатраты.СуммаВключаетНДС, ЛОЖЬ)
				ТОГДА ЕСТЬNULL(уатМаршрутныйЛистЗатраты.Сумма, 0) - ЕСТЬNULL(уатМаршрутныйЛистЗатраты.СуммаНДС, 0)
			ИНАЧЕ ЕСТЬNULL(уатМаршрутныйЛистЗатраты.Сумма, 0)
		КОНЕЦ) КАК ЗатратыМЛБезНДС
ПОМЕСТИТЬ ВТ_СуммыПоМЛ
ИЗ
	ВТ_МЛ КАК ВТ_МЛ
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Доходы КАК уатМаршрутныйЛистДоходы
		ПО ВТ_МЛ.МаршрутныйЛист = уатМаршрутныйЛистДоходы.Ссылка
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Расходы КАК уатМаршрутныйЛистЗатраты
		ПО ВТ_МЛ.МаршрутныйЛист = уатМаршрутныйЛистЗатраты.Ссылка

СГРУППИРОВАТЬ ПО
	ВТ_МЛ.МаршрутныйЛист
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	уатСтатусыСопроводительныхДокументов.СопроводительныйДокумент.Основание КАК ЗаказНаТС,
	СУММА(ВЫБОР
			КОГДА уатСтатусыСопроводительныхДокументов.Статус = ЗНАЧЕНИЕ(Справочник.уатСтатусы_уэ.ОбработкаЗавершена)
				ТОГДА 1
			ИНАЧЕ 0
		КОНЕЦ) КАК КоличествоВыполнено,
	КОЛИЧЕСТВО(уатСтатусыСопроводительныхДокументов.СопроводительныйДокумент) КАК КоличествоВсего
ПОМЕСТИТЬ ВТ_СтатусыВыполненияДокументов
ИЗ
	РегистрСведений.уатСтатусыСопроводительныхДокументов.СрезПоследних(
			,
			СопроводительныйДокумент.Основание В
				(ВЫБРАТЬ
					ВТ_Заказы.ЗаказНаТС
				ИЗ
					ВТ_Заказы)) КАК уатСтатусыСопроводительныхДокументов

СГРУППИРОВАТЬ ПО
	уатСтатусыСопроводительныхДокументов.СопроводительныйДокумент.Основание
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Документы.МаршрутныйЛист КАК МаршрутныйЛист,
	ВТ_Документы.ТС КАК ТС,
	ВТ_Документы.ЗаказНаТС КАК ЗаказНаТС,
	ВТ_Документы.Контрагент КАК Контрагент,
	ВЫБОР
		КОГДА ВТ_СтатусыВыполненияДокументов.ЗаказНаТС ЕСТЬ NULL
			ТОГДА ""
		КОГДА ВТ_СтатусыВыполненияДокументов.КоличествоВыполнено = 0
			ТОГДА "Не выполнены"
		КОГДА ВТ_СтатусыВыполненияДокументов.КоличествоВыполнено = ВТ_СтатусыВыполненияДокументов.КоличествоВсего
			ТОГДА "Выполнены"
		ИНАЧЕ "Частично выполнены"
	КОНЕЦ КАК ВыполнениеДокументов,
	ВТ_Документы.СтатусЗаказа КАК СтатусЗаказа,
	ВТ_Документы.СостояниеЗаказа КАК СостояниеЗаказа,
	ЕСТЬNULL(ВТ_СуммыПоЗаказам.ДоходыЗаказ, 0) КАК ДоходыЗаказ,
	ЕСТЬNULL(ВТ_СуммыПоЗаказам.ЗатратыЗаказ, 0) КАК ЗатратыЗаказ,
	ЕСТЬNULL(ВТ_СуммыПоМЛ.ДоходыМЛ, 0) КАК ДоходыМЛ,
	ЕСТЬNULL(ВТ_СуммыПоМЛ.ЗатратыМЛ, 0) КАК ЗатратыМЛ,
	ЕСТЬNULL(ВТ_СуммыПоЗаказам.ДоходыЗаказБезНДС, 0) КАК ДоходыЗаказБезНДС,
	ЕСТЬNULL(ВТ_СуммыПоЗаказам.ЗатратыЗаказБезНДС, 0) КАК ЗатратыЗаказБезНДС,
	ЕСТЬNULL(ВТ_СуммыПоМЛ.ДоходыМЛБезНДС, 0) КАК ДоходыМЛБезНДС,
	ЕСТЬNULL(ВТ_СуммыПоМЛ.ЗатратыМЛБезНДС, 0) КАК ЗатратыМЛБезНДС,
	ВТ_Документы.ПроцентВыполнения КАК ПроцентВыполнения
ИЗ
	ВТ_Документы КАК ВТ_Документы
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СуммыПоЗаказам КАК ВТ_СуммыПоЗаказам
		ПО ВТ_Документы.ЗаказНаТС = ВТ_СуммыПоЗаказам.ЗаказНаТС
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СуммыПоМЛ КАК ВТ_СуммыПоМЛ
		ПО ВТ_Документы.МаршрутныйЛист = ВТ_СуммыПоМЛ.МаршрутныйЛист
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СтатусыВыполненияДокументов КАК ВТ_СтатусыВыполненияДокументов
		ПО ВТ_Документы.ЗаказНаТС = ВТ_СтатусыВыполненияДокументов.ЗаказНаТС</query>
	</dataSet>
	<calculatedField>
		<dataPath>СостояниеВыполненияСтрока</dataPath>
		<expression>Строка(ПроцентВыполнения) + "% " + Нстр("en = 'done'; ru = 'выполнено'")</expression>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Состояние выполнения строка</v8:content>
			</v8:item>
		</title>
	</calculatedField>
	<parameter>
		<name>ПериодОтчета</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Период</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>v8:StandardPeriod</v8:Type>
		</valueType>
		<value xsi:type="v8:StandardPeriod">
			<v8:variant xsi:type="v8:StandardPeriodVariant">Custom</v8:variant>
			<v8:startDate>0001-01-01T00:00:00</v8:startDate>
			<v8:endDate>0001-01-01T00:00:00</v8:endDate>
		</value>
		<useRestriction>false</useRestriction>
		<use>Always</use>
	</parameter>
	<parameter>
		<name>Период</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Период</v8:content>
			</v8:item>
			<v8:item>
				<v8:lang>en</v8:lang>
				<v8:content>Period</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ДатаС</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата начала</v8:content>
			</v8:item>
			<v8:item>
				<v8:lang>en</v8:lang>
				<v8:content>Start date</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
		<expression>&amp;ПериодОтчета.ДатаНачала</expression>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ДатаПо</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата окончания</v8:content>
			</v8:item>
			<v8:item>
				<v8:lang>en</v8:lang>
				<v8:content>End date</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
		<expression>&amp;ПериодОтчета.ДатаОкончания</expression>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ДатаМаршрутныхЛистов</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата маршрутных листов</v8:content>
			</v8:item>
			<v8:item>
				<v8:lang>en</v8:lang>
				<v8:content>Date of routing lists</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:string</v8:Type>
			<v8:StringQualifiers>
				<v8:Length>20</v8:Length>
				<v8:AllowedLength>Variable</v8:AllowedLength>
			</v8:StringQualifiers>
		</valueType>
		<value xsi:type="xs:string"/>
		<useRestriction>false</useRestriction>
		<availableValue>
			<value xsi:type="xs:string">Дата документа</value>
			<presentation xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Дата документа</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Document date</v8:content>
				</v8:item>
			</presentation>
		</availableValue>
		<availableValue>
			<value xsi:type="xs:string">Дата отправления</value>
			<presentation xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Дата отправления</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Date of departure</v8:content>
				</v8:item>
			</presentation>
		</availableValue>
		<availableValue>
			<value xsi:type="xs:string">Дата выполнения</value>
			<presentation xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Дата выполнения</v8:content>
				</v8:item>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Execution date</v8:content>
				</v8:item>
			</presentation>
		</availableValue>
		<use>Always</use>
	</parameter>
	<settingsVariant>
		<dcsset:name>Сверка маршрутных листов и заказов</dcsset:name>
		<dcsset:presentation xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Сверка маршрутных листов и заказов</v8:content>
			</v8:item>
			<v8:item>
				<v8:lang>en</v8:lang>
				<v8:content>Collation of routing lists and orders</v8:content>
			</v8:item>
		</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>МаршрутныйЛист</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ТС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЗаказНаТС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Контрагент</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ВыполнениеДокументов</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СтатусЗаказа</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СостояниеЗаказа</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДоходыЗаказБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДоходыЗаказ</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДоходыМЛБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДоходыМЛ</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЗатратыЗаказБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЗатратыЗаказ</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЗатратыМЛБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЗатратыМЛ</dcsset:field>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:dataParameters>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>ПериодОтчета</dcscor:parameter>
					<dcscor:value xsi:type="v8:StandardPeriod">
						<v8:variant xsi:type="v8:StandardPeriodVariant">ThisMonth</v8:variant>
					</dcscor:value>
					<dcsset:userSettingID>50753ce0-1632-424e-b454-355714aeeec4</dcsset:userSettingID>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:use>false</dcscor:use>
					<dcscor:parameter>ДатаС</dcscor:parameter>
					<dcscor:value xsi:type="xs:dateTime">0001-01-01T00:00:00</dcscor:value>
					<dcsset:userSettingID>e5214138-c6c1-4723-89a8-e01e16071491</dcsset:userSettingID>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:use>false</dcscor:use>
					<dcscor:parameter>ДатаПо</dcscor:parameter>
					<dcscor:value xsi:type="xs:dateTime">0001-01-01T00:00:00</dcscor:value>
					<dcsset:userSettingID>df9691aa-6ebe-4580-8db6-ae49a33f6592</dcsset:userSettingID>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>ДатаМаршрутныхЛистов</dcscor:parameter>
					<dcscor:value xsi:type="xs:string">Дата документа</dcscor:value>
					<dcsset:userSettingID>ebef3313-089f-4e2f-b06a-c43443848764</dcsset:userSettingID>
				</dcscor:item>
			</dcsset:dataParameters>
			<dcsset:order>
				<dcsset:item xsi:type="dcsset:OrderItemField">
					<dcsset:field>МаршрутныйЛист.Дата</dcsset:field>
					<dcsset:orderType>Asc</dcsset:orderType>
				</dcsset:item>
			</dcsset:order>
			<dcsset:conditionalAppearance>
				<dcsset:item>
					<dcsset:selection>
						<dcsset:item>
							<dcsset:field>СостояниеЗаказа</dcsset:field>
						</dcsset:item>
					</dcsset:selection>
					<dcsset:filter>
						<dcsset:item xsi:type="dcsset:FilterItemComparison">
							<dcsset:left xsi:type="dcscor:Field">СостояниеЗаказа</dcsset:left>
							<dcsset:comparisonType>Equal</dcsset:comparisonType>
							<dcsset:right xsi:type="dcscor:DesignTimeValue">Перечисление.уатСостоянияВыполненияЗаказов.ЧастичноВыполнен</dcsset:right>
						</dcsset:item>
					</dcsset:filter>
					<dcsset:appearance>
						<dcscor:item xsi:type="dcsset:SettingsParameterValue">
							<dcscor:parameter>Текст</dcscor:parameter>
							<dcscor:value xsi:type="dcscor:Field">СостояниеВыполненияСтрока</dcscor:value>
						</dcscor:item>
					</dcsset:appearance>
				</dcsset:item>
			</dcsset:conditionalAppearance>
			<dcsset:outputParameters>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>РасположениеИтогов</dcscor:parameter>
					<dcscor:value xsi:type="dcscor:DataCompositionTotalPlacement">None</dcscor:value>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>ГоризонтальноеРасположениеОбщихИтогов</dcscor:parameter>
					<dcscor:value xsi:type="dcscor:DataCompositionTotalPlacement">None</dcscor:value>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>ВертикальноеРасположениеОбщихИтогов</dcscor:parameter>
					<dcscor:value xsi:type="dcscor:DataCompositionTotalPlacement">None</dcscor:value>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:use>false</dcscor:use>
					<dcscor:parameter>Заголовок</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>Сверка маршрутных листов и заказов</v8:content>
						</v8:item>
						<v8:item>
							<v8:lang>en</v8:lang>
							<v8:content>Collation of routing lists and orders</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</dcsset:outputParameters>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
				</dcsset:selection>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>